@page "/dashboard"
@using LawyerServices.Services.Data
@using LawyerServices.Common.WorkingTimeModels

@inject NavigationManager navigationManager
@inject ICompanyService companyService
@inject IWorkingTimeExceptionService wteService

@inject AuthenticationStateProvider authenticationStateProvider

@layout Administration.Shared.AdminLayout

<AuthorizeView Roles="Lawyer">
    <Authorized>
        <div class="content">
            <div class="container-fluid">

                <div class="row">


                    <div class="col-md-10 col-lg-11 col-xl-12">

                        <div class="row">
                            <div class="col-md-12">
                                <div class="card dash-card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12 col-lg-4">
                                                <div class="dash-widget dct-border-rht">
                                                    <div class="circle-bar circle-bar1">
                                                        <div class="circle-graph1" data-percent="75">
                                                            <img src="/images/justice.png" class="img-fluid" alt="patient">
                                                        </div>
                                                    </div>
                                                    <div class="dash-widget-info">
                                                        <h6>Total Patient</h6>
                                                        <h3>@count</h3>
                                                        <p class="text-muted">Till Today</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-12 col-lg-4">
                                                <div class="dash-widget dct-border-rht">
                                                    <div class="circle-bar circle-bar2">
                                                        <div class="circle-graph2" data-percent="65">
                                                            <img src="/images/justice.png" class="img-fluid" alt="Patient">
                                                        </div>
                                                    </div>
                                                    <div class="dash-widget-info">
                                                        <h6>Today Patient</h6>
                                                        <h3>@todayCount</h3>
                                                        <p class="text-muted">@DateTime.UtcNow.Date</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-12 col-lg-4">
                                                <div class="dash-widget">
                                                    <div class="circle-bar circle-bar3">
                                                        <div class="circle-graph3" data-percent="50">
                                                            <img src="/images/justice.png" class="img-fluid" alt="Patient">
                                                        </div>
                                                    </div>
                                                    <div class="dash-widget-info">
                                                        <h6>Appoinments</h6>
                                                        <h3>85</h3>
                                                        <p class="text-muted">06, Apr 2019</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <h4 class="mb-4">Patient Appoinment</h4>
                                <div class="appointment-tab">

                                    <!-- Appointment Tab -->
                                    <ul class="nav nav-tabs nav-tabs-solid nav-tabs-rounded">
                                        <li class="nav-item">
                                            <a class="nav-link active"  href="" @onclick="OnClickUpcoming" style="@light" data-toggle="tab"  @onclick:preventDefault>Upcoming</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="" @onclick="OnClickToday" style="@blue" data-toggle="tab"  @onclick:preventDefault>Today</a>
                                        </li>
                                    </ul>
                                    <!-- /Appointment Tab -->

                                    <div class="tab-content">

                                        <!-- Upcoming Appointment Tab -->
                                        <div class="tab-pane show active" id="upcoming-appointments">
                                            <div class="card card-table mb-0">
                                                <div class="card-body">
                                                    <div class="table-responsive">
                                                        <table class="table table-hover table-center mb-0">
                                                            <thead>
                                                                <tr>
                                                                    <th>Patient Name</th>
                                                                    <th>Appt Date</th>
                                                                    <th>Purpose</th>
                                                                    <th>Type</th>
                                                                    <th class="text-center">Paid Amount</th>
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                          @if (wtexceptions.Any())
                                                         {
                                                                   @foreach (var item in wtexceptions)
                                                                {
                                                                    <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">@item.User.FirstName @item.User.LastName <span>#PT0016</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>@item.StarFrom.Date <span class="d-block text-info">@item.StarFrom.TimeOfDay</span></td>
                                                                    <td>General</td>
                                                                    <td>New Patient</td>
                                                                    <td class="text-center">$150</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                }
                                                         }
                                                                @*<tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Richard Wilson <span>#PT0016</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>11 Nov 2019 <span class="d-block text-info">10.00 AM</span></td>
                                                                    <td>General</td>
                                                                    <td>New Patient</td>
                                                                    <td class="text-center">$150</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Charlene Reed <span>#PT0001</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>3 Nov 2019 <span class="d-block text-info">11.00 AM</span></td>
                                                                    <td>General</td>
                                                                    <td>Old Patient</td>
                                                                    <td class="text-center">$200</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Travis Trimble  <span>#PT0002</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>1 Nov 2019 <span class="d-block text-info">1.00 PM</span></td>
                                                                    <td>General</td>
                                                                    <td>New Patient</td>
                                                                    <td class="text-center">$75</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Carl Kelly <span>#PT0003</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>30 Oct 2019 <span class="d-block text-info">9.00 AM</span></td>
                                                                    <td>General</td>
                                                                    <td>Old Patient</td>
                                                                    <td class="text-center">$100</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Michelle Fairfax <span>#PT0004</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>28 Oct 2019 <span class="d-block text-info">6.00 PM</span></td>
                                                                    <td>General</td>
                                                                    <td>New Patient</td>
                                                                    <td class="text-center">$350</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Gina Moore <span>#PT0005</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>27 Oct 2019 <span class="d-block text-info">8.00 AM</span></td>
                                                                    <td>General</td>
                                                                    <td>Old Patient</td>
                                                                    <td class="text-center">$250</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>*@
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /Upcoming Appointment Tab -->
                                        <!-- Today Appointment Tab -->
                                        <div class="tab-pane" id="today-appointments">
                                            <div class="card card-table mb-0">
                                                <div class="card-body">
                                                    <div class="table-responsive">
                                                        <table class="table table-hover table-center mb-0">
                                                            <thead>
                                                                <tr>
                                                                    <th>Patient Name</th>
                                                                    <th>Appt Date</th>
                                                                    <th>Purpose</th>
                                                                    <th>Type</th>
                                                                    <th class="text-center">Paid Amount</th>
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Elsie Gilley <span>#PT0006</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>14 Nov 2019 <span class="d-block text-info">6.00 PM</span></td>
                                                                    <td>Fever</td>
                                                                    <td>Old Patient</td>
                                                                    <td class="text-center">$300</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Joan Gardner <span>#PT0006</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>14 Nov 2019 <span class="d-block text-info">5.00 PM</span></td>
                                                                    <td>General</td>
                                                                    <td>Old Patient</td>
                                                                    <td class="text-center">$100</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Daniel Griffing <span>#PT0007</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>14 Nov 2019 <span class="d-block text-info">3.00 PM</span></td>
                                                                    <td>General</td>
                                                                    <td>New Patient</td>
                                                                    <td class="text-center">$75</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Walter Roberson <span>#PT0008</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>14 Nov 2019 <span class="d-block text-info">1.00 PM</span></td>
                                                                    <td>General</td>
                                                                    <td>Old Patient</td>
                                                                    <td class="text-center">$350</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Robert Rhodes <span>#PT0010</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>14 Nov 2019 <span class="d-block text-info">10.00 AM</span></td>
                                                                    <td>General</td>
                                                                    <td>New Patient</td>
                                                                    <td class="text-center">$175</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        <h2 class="table-avatar">
                                                                            <a href="patient-profile.html" class="avatar avatar-sm mr-2"><img class="avatar-img rounded-circle" src="/images/justice.png" alt="User Image"></a>
                                                                            <a href="patient-profile.html">Harry Williams <span>#PT0011</span></a>
                                                                        </h2>
                                                                    </td>
                                                                    <td>14 Nov 2019 <span class="d-block text-info">11.00 AM</span></td>
                                                                    <td>General</td>
                                                                    <td>New Patient</td>
                                                                    <td class="text-center">$450</td>
                                                                    <td class="text-right">
                                                                        <div class="table-action">
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-info-light">
                                                                                <i class="far fa-eye"></i> View
                                                                            </a>

                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-success-light">
                                                                                <i class="fas fa-check"></i> Accept
                                                                            </a>
                                                                            <a href="javascript:void(0);" class="btn btn-sm bg-danger-light">
                                                                                <i class="fas fa-times"></i> Cancel
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /Today Appointment Tab -->

                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

        </div>
    </Authorized>
    <NotAuthorized>
        @{
            navigationManager.NavigateTo("/Identity/Account/Login");
        }
    </NotAuthorized>
</AuthorizeView>

@code {
    int count;
    List<WorkingTimeExceptionBookingModel> wtexceptions;

    string blue;

    string light;

    [Parameter]
    public string UserId { get; set;}

    [Parameter]
    public DateTime searchDate { get; set;}
    int todayCount;
    protected override void OnInitialized()
    {

        base.OnInitializedAsync();
        var user = authenticationStateProvider.GetAuthenticationStateAsync().Result.User;
        UserId = user.FindFirst(u => u.Type.Contains("nameidentifier"))?.Value;
        this.searchDate = DateTime.UtcNow;
        this.wtexceptions = this.wteService.GetAllRequestsByDayOfWeek(UserId, searchDate).ToList();
        count = this.companyService.UsersCount(UserId);
        todayCount = this.companyService.UsersTodayCount(UserId);

    }
    void OnClickToday()
    {
        blue = "background-color: #20c0f3 ; color : #ffff";
        light = "background-color: #F0F8FF ; color : #272b41";
        this.wtexceptions = this.wteService.GetAllRequestsByDayOfWeek(UserId, searchDate).ToList();
        StateHasChanged();
    }
    void OnClickUpcoming()
    {
        blue = "background-color: #F0F8FF ; color : #272b41";
        light = "background-color: #20c0f3 ; color : #ffff";

        //not work corectly date
        searchDate = searchDate.AddDays(1);
        this.wtexceptions = this.wteService.GetAllRequestsByDayOfWeek(UserId, searchDate).ToList();
        searchDate = searchDate = DateTime.UtcNow;
        StateHasChanged();
    }

 }